<!DOCTYPE html>
<html>
  <head>
      <script type="text/javascript">
          window.languagePluginUrl = './build/';
      </script>
      <script src="./build/pyodide.js"></script>
  </head>
  <body id="root">
	<div id="action">Loading...</div>
    <script type="text/javascript">
		testPlot = `
import sys, json, math

import numpy as np
x = np.linspace(0, 2.0 * np.pi, 100)
y = np.sin(x)

from matplotlib import pyplot as plt
plt.figure()
plt.plot(x, y)
# plt.show()

from matplotlib.backends import backend_agg
if "pyodide" in sys.modules:
    from js import document, ImageData

def create_root_element1(self):
    print('my create_root_element!')
    div = document.createElement('div')
    document.body.appendChild(div)
    return div

f = plt.gcf()

#override create_root_element method of canvas by one of the functions above
f.canvas.create_root_element = create_root_element1.__get__(f.canvas, f.canvas.__class__)

print('showing')
f.canvas.show()
print('done')
`

    languagePluginLoader.then(() => {
      return pyodide.loadPackage('matplotlib')
    }).then(() => {
      pyodide.runPython(testPlot);
    })
    </script>
  </body>
</html>
