<!DOCTYPE html>
<html lang="en">
    <head>
            <meta charset="utf-8" />
            <title>MediaInfo JavaScript test page</title>
    </head>
    <body>
        <p>
            <input type="file" id="input" />
        </p>
      <button id="getResults" disabled>Get Results</button>
        <p><pre id="result"></pre></p>

<script type="text/javascript">  
   function iOS() {
    //return true;
    return [ 'iPad Simulator', 'iPhone Simulator', 'iPod Simulator',
            'iPad', 'iPhone', 'iPod' ].includes(navigator.platform)
      || (navigator.userAgent.includes("Mac") && "ontouchend" in document);  // iPad on iOS 13 detection
  }
  </script>
  
        <script type="text/javascript">
            // Load the WebAssembly MediaInfo module if the browser supports it,
            // otherwise load the asmjs module
            let MediaInfoJs = document.createElement('script');
            if ('WebAssembly' in window && typeof Promise  !== 'undefined' && !iOS() ) {
              MediaInfoJs.src = "scripts/MediaInfoWasm.js";
            } else {
              MediaInfoJs.src = "scripts/MediaInfo.js";
            }
            document.body.appendChild(MediaInfoJs);

            let MediaInfoModule;
          
            // Continue initialization
            MediaInfoJs.onload = function () {

              /*var MediaInfoModule, MI, processing = false;
              
              var finish = function() {
                  MI.Close();
                  MI.delete();
                  processing = false;
              }

              // Examples about how to get results
              var showResult = function() {

                document.getElementById('result').innerText = 'Frame rate :\n';
                document.getElementById('result').innerText += MI.Get(MediaInfoModule.Stream.Video, 0, 'FrameRate') + '\n\n';
                document.getElementById('result').innerText += 'Rotation :\n';
                document.getElementById('result').innerText += MI.Get(MediaInfoModule.Stream.Video, 0, 'Rotation') + '\n\n';

                finish();
              }

              var parseFile = function(file, callback) {
                if (processing) {
                  return;
                }
                processing = true;

                // Initialise MediaInfo
                MI = new MediaInfoModule.MediaInfo();

                //Open the file
                MI.Open(file, callback);

              }

              // Initialise emscripten module
              var ready = function() {
                console.debug('MediaInfo ready');

                // Get selected file
                var input = document.getElementById('input');
                input.onchange = function() {
                  if(input.files.length > 0) {
                    document.getElementById('result').innerText = "Processing...";
                    parseFile(input.files[0], showResult);
                  }
                }
              }*/
              MediaInfoModule = MediaInfoLib({
                'postRun': function() {
                  if (typeof Promise !== 'undefined' && MediaInfoModule instanceof Promise) {
                    MediaInfoModule.then(function(module) {
                      MediaInfoModule = module;
                      //ready();
                    });
                  }
                  else {
                    //ready();
                  }
                }
              });
            };
        </script>
  
  <script type="text/javascript">  

                    // Get selected file
                var input = document.getElementById('input');
                input.onchange = function() {
                  if(input.files.length > 0) {
                    document.getElementById('getResults').removeAttribute('disabled');
                  }
                }


    document.getElementById('getResults').onclick = function() {
      let MI, processing = false;
              
      console.log("tot hier");
      let finish = function() {
         MI.Close();
         MI.delete();
      }
      // Examples about how to get results
      let showResult = function() {

       document.getElementById('result').innerText = 'Frame rate :\n';
                document.getElementById('result').innerText += MI.Get(MediaInfoModule.Stream.Video, 0, 'FrameRate') + '\n\n';
                document.getElementById('result').innerText += 'Rotation :\n';
                document.getElementById('result').innerText += MI.Get(MediaInfoModule.Stream.Video, 0, 'Rotation') + '\n\n';

                finish();
              }
              
      // Initialise MediaInfo
      MI = new MediaInfoModule.MediaInfo();

      //Open the file
      MI.Open(input.files[0], showResult);



    }
  </script>
  
    </body>
</html>
